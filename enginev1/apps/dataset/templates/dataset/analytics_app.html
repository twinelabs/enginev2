{% load compress %}
{% load staticfiles %}

<!DOCTYPE html>

<html>
<head>
  <title>Twine - {% block title %}{% endblock %}</title>

  <link href="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="http://cdnjs.cloudflare.com/ajax/libs/angular-ui-grid/3.2.6/ui-grid.min.css" rel="stylesheet"/>
  <link href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet"/>

  <link type="text/css" href="{% static "css/dashboard/db_styles.min.css" %}" rel="stylesheet">
</head>

<body ng-app="{% block ng_app %}dashApp{% endblock %}">
<div class="content" ng-controller="{% block ng_controller %}dashCtrl as _{% endblock %}">

{% verbatim %}

  <div class="dashboard">

    <div class="row">
      <div class="col col-md-12">
        <div class="section section-top-table">

          <div class="title">Select Data Set</div>

          <div class="row">
            <div class="col col-md-12">
              <div class="btn btn-default btn-lg" ng-repeat="t in _.tables track by t.id"
                   ng-class="{ active: t.id == _.selectedTable.id }"
                   ng-click="_.selectedTable = t"
              ><div>{{ t.name }}</div><div class="count">{{t.data.length}}</div></div>
              <!--<select-->
                  <!--name="tableSelect"-->
                  <!--ng-model="_.selectedTable"-->
                  <!--ng-options="option.name for option in _.tables track by option.id"-->
              <!--&gt;</select>-->
            </div>
          </div>

        </div>
        <div class="section section-top-view">

          <div class="title">Select View</div>

          <div class="row">
            <div class="col col-md-12">
              <div class="view" ng-repeat="v in _.views track by v.id"
                   ng-class="{ active: v.id == _.selectedView.id }"
                   ng-click="_.selectedView = v"
              ><a href="">{{ v.name }}</a></div>
            </div>
          </div>

        </div>
      </div>
    </div>

    <div class="row">

      <div class="col col-md-3">
        <div class="section section-left">

          <div class="title">Tables & Data Fields</div>

          <ul>
            <li class="types" ng-repeat="t in _.getFieldTypes() track by $index">

              <span class="arrow" ng-class="{ open: _.dataFieldsByType[t].open }"></span>
              <div class="typeName" ng-click="_.dataFieldsByType[t].open = !_.dataFieldsByType[t].open">
                {{ _.dataFieldsByType[t].name }}
              </div>

              <ul class="fieldList" ng-class="{ open: _.dataFieldsByType[t].open }">
                <li class="fields" ng-repeat="f in _.dataFieldsByType[t].fields track by $index"
                     ng-class="{ active: f == _.selectedDataField }"
                     ng-click="_.selectedDataField = f"
                >{{ f }}</li>
              </ul>

            </li>
          </ul>

        </div>
      </div>

      <div class="col col-md-9">

        <div class="section section-right" ng-if="_.selectedView.id == 1">

          <div class="title"> Chart {{ _.selectedDataField ? ' &dash; ' + _.selectedDataField : '' }}</div>

          <div class="chart-container">
            <div ng-if="_.showGrid" class="controls">

              <div class="sort">
                <span>sort: </span>
                <div class="view" ng-repeat="c in _.chartControlSort track by c.id"
                     ng-class="{ active: c.id == _.selectedChartControlSort.id }"
                     ng-click="_.selectedChartControlSort = c"
                ><a href="">{{ c.name }}</a></div>
              </div>

              <div class="scale">
                <span>scale: </span>
                <div class="view" ng-repeat="c in _.chartControlScale track by c.id"
                     ng-class="{ active: c.id == _.selectedChartControlScale.id }"
                     ng-click="_.selectedChartControlScale = c"
                ><a href="">{{ c.name }}</a></div>
              </div>

            </div>

            <div id="chart"></div>

            <div ng-if="_.showGrid" class="dropdown">
              <button class="dropbtn">Export</button>
              <div class="dropdown-content">
                <a href="" ng-click="_.click('png', $event)">PNG</a>
                <a href="" ng-click="_.click('pdf', $event)">PDF</a>
              </div>
            </div>

          </div>


          <div class="grid-container">
            <div ng-if="_.showGrid" ui-grid="_.gridOptions" class="grid"></div>

            <div ng-if="_.showGrid" class="dropdown">
              <button class="dropbtn">Export</button>
              <div class="dropdown-content">
                <a href="" ng-click="_.click('csv', $event)">CSV</a>
                <a href="" ng-click="_.click('json', $event)">JSON</a>
              </div>
            </div>

          </div>

        </div>

        <div class="section section-right" ng-if="_.selectedView.id == 0">
          <div class="title"> Summary </div>
        </div>

        <div class="section section-right" ng-if="_.selectedView.id == 2">
          <div class="title"> Statistics </div>
        </div>

      </div>

    </div>

  </div>

{% endverbatim %}
</div>

  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.7/angular.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-grid/3.2.6/ui-grid.min.js"></script>
  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

  <script type='text/javascript'>
    var myTables = {{ dashboard_s|safe }};
  </script>

  <script src="{% static "scripts/dashboard/analytics_app.js" %}"></script>

  <script src="{% static "scripts/dashboard/libs/blob/blob.js" %}"></script>
  <script src="{% static "scripts/dashboard/libs/FileSaver/FileSaver.min.js" %}"></script>
  <script src="{% static "scripts/dashboard/libs/pdfmake/pdfmake.min.js" %}"></script>
  <script src="{% static "scripts/dashboard/libs/pdfmake/vfs_fonts.js" %}"></script>
  <script src="{% static "scripts/dashboard/libs/chart-export/chart-export.js" %}"></script>

</body>
</html>